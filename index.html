<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ANKVIDHYA ERP</title>

  <!-- Favicon / Logo -->
  <link rel="icon" href="/images/Ank_Logo.png">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/styles.css">
  <!-- ===== critical theme variables (fallback if /css/styles.css fails) ===== -->
<style id="critical-theme-vars">
:root {
  --primary-color:#d4a759;
  --secondary-color:#b55c3b;
  --accent-color:#f5e9da;
  --dark-text:#3d2c1d;
  --light-background:#f8f9fa;

  --brand:#5d9bf8;
  --brand-2:#6c757d;

  --ok:#16a34a;
  --warn:#f59e0b;
  --bad:#dc3545;

  --card:#fff;
  --muted:#6b7280;
  --ghost:#f8f9fa;

  --ring: rgba(13,110,253,.35);
  --trans-fast: all .2s ease;
  --trans-slow: all .4s ease;
}

[data-bs-theme="dark"] {
  --primary-color:#6366f1;
  --secondary-color:#06b6d4;
  --accent-color:#1e293b;
  --dark-text:#e2e8f0;
  --light-background:#0f172a;

  --brand:#4f46e5;
  --brand-2:#0ea5e9;

  --ok:#22c55e;
  --warn:#facc15;
  --bad:#f87171;

  --card:#1e293b;
  --ghost:#111827;
  --muted:#94a3b8;

  --bs-body-bg: #0f172a;
  --bs-body-color: #e2e8f0;
  --bs-border-color: rgba(255,255,255,0.08);
}

/* minimal styling that matters for theme visual change */
body {
  background: var(--light-background);
  transition: var(--trans-slow);
  font-family: 'Poppins', sans-serif;
  color: var(--dark-text);
}
[data-bs-theme="dark"] body {
  background: var(--bs-body-bg);
  color: var(--bs-body-color);
}
</style>

<!-- then load the full stylesheet (normal) -->
<link rel="stylesheet" href="/css/styles.css">

</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Topbar -->
  <nav class="navbar navbar-expand bg-body border-bottom sticky-top shadow-sm">
    <div class="container-fluid">
      <!-- universal sidebar toggle -->
      <button class="btn btn-outline-secondary me-2" type="button" data-sidebar-toggle>
        <i class="bi bi-list"></i>
      </button>

      <a class="navbar-brand d-flex align-items-center gap-2 fw-semibold" href="#/dashboard">
        <img src="/images/Ank_Logo.png" alt="ANKVIDHYA" class="brand-logo">
        <span>ANKVIDHYA ERP</span>
      </a>

      <div class="ms-auto d-flex align-items-center gap-2">
        <!-- Theme -->
        <button id="btnTheme" class="btn btn-outline-secondary" title="Toggle theme">
          <i class="bi bi-moon"></i>
        </button>

        <!-- Notifications -->
        <div class="dropdown">
          <button class="btn btn-outline-secondary position-relative" data-bs-toggle="dropdown" aria-expanded="false" title="Notifications">
            <i class="bi bi-bell"></i>
            <span id="notifDot" class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle d-none"></span>
          </button>
          <div class="dropdown-menu dropdown-menu-end p-0" style="min-width:320px;max-height:400px;overflow:auto">
            <div class="list-group list-group-flush" id="notifList">
              <div class="list-group-item text-muted small">No notifications</div>
            </div>
          </div>
        </div>

        <!-- Profile -->
        <div class="dropdown">
          <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle me-1"></i><span id="topProfileName">Profile</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#/settings"><i class="bi bi-gear"></i> Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><button id="btnLogout" class="dropdown-item text-danger"><i class="bi bi-box-arrow-right"></i> Logout</button></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="appSidebar">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
      <div class="list-group list-group-flush" id="sidebarMenu">
        <!-- filled by menu.js -->
      </div>
    </div>
  </div>

  <!-- Main outlet -->
  <main class="container-fluid my-3">
    <div id="app"></div>
  </main>

  <!-- Toasts -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastArea"></div>

  <!-- Vendor JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Core libs -->
  <script src="/js/ui.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/api.js"></script>

  <!-- Role-based sidebar -->
  <script src="/js/menu.js"></script>
  <script src="/js/rls.js"></script>

  <!-- Router -->
  <script src="/js/scope.js"></script>
  <script src="/js/router.js"></script>

  <!-- Components -->
  <script src="/js/components/datagrid.js"></script>
  <script src="/js/components/formkit.js"></script>

  <!-- Pages -->
  <script src="/js/pages/login.js"></script>
  <script src="/js/pages/dashboard.js"></script>
  <script src="/js/pages/reports.js"></script>
  <script src="/js/pages/students.js"></script>
  <script src="/js/pages/users.js"></script>
  <script src="/js/pages/master.js"></script>
  <script src="/js/pages/employees.js"></script>
  <script src="/js/pages/schools.js"></script>
  <script src="/js/pages/courses.js"></script>
  <script src="/js/pages/books.js"></script>
  <script src="/js/pages/chapters.js"></script>
  <script src="/js/pages/faculty-assign.js"></script>
  <script src="/js/pages/lessonplans.js"></script>
  <script src="/js/pages/videos.js"></script>
  <script src="/js/pages/payments.js"></script>
  <script src="/js/pages/payrolls.js"></script>
  <script src="/js/pages/expenses.js"></script>
  <script src="/js/pages/faculty-dp.js"></script>
  <script src="/js/pages/emp-video-progress.js"></script>
  <script src="/js/pages/timetables.js"></script>
  <script src="/js/pages/class-sessions.js"></script>
  <script src="/js/pages/emp-attendance.js"></script>
  <script src="/js/pages/student-attendance.js"></script>
  <script src="/js/pages/notebook-checks.js"></script>

  <!-- Bootstrap + app boot -->
  <script src="/js/app.js"></script>

  <!-- Minimal robust theme toggler (DOM-ready, safe localStorage, system pref) -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const KEY = 'theme';
    const html = document.documentElement;
    const body = document.body;
    const btn = document.getElementById('btnTheme');
    const ICON_MOON = 'bi-moon';
    const ICON_SUN = 'bi-brightness-high';

    function safeGetStorage(key) {
      try { return localStorage.getItem(key); } catch (e) { return null; }
    }
    function safeSetStorage(key, value) {
      try { localStorage.setItem(key, value); } catch (e) { /* ignore */ }
    }

    function systemPref() {
      try {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      } catch (e) { return 'light'; }
    }

    function applyTheme(theme) {
      theme = theme === 'dark' ? 'dark' : 'light';
      html.setAttribute('data-bs-theme', theme);
      body.setAttribute('data-bs-theme', theme);

      // Update button icon (if present)
      if (btn) {
        const icon = btn.querySelector('i');
        if (icon) {
          icon.classList.remove(ICON_MOON, ICON_SUN);
          icon.classList.add(theme === 'dark' ? ICON_SUN : ICON_MOON);
        }
      }
    }

    function initTheme() {
      const stored = safeGetStorage(KEY);
      const start = stored || systemPref() || 'light';
      applyTheme(start);
    }

    function toggleTheme() {
      const current = html.getAttribute('data-bs-theme') || 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      applyTheme(next);
      safeSetStorage(KEY, next);
    }

    initTheme();

    if (btn) btn.addEventListener('click', toggleTheme);

    // Auto-update on system change only if user hasn't explicitly chosen a theme
    if (window.matchMedia) {
      try {
        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        mq.addEventListener('change', (e) => {
          if (safeGetStorage(KEY) == null) {
            applyTheme(e.matches ? 'dark' : 'light');
          }
        });
      } catch (e) {
        // ignore if addEventListener not supported
      }
    }
  });
  </script>

</body>
</html>
