<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ANKVIDHYA ERP</title>

  <!-- Favicon / Logo -->
  <link rel="icon" href="/images/Ank_Logo.png">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">

  <!-- Custom CSS (critical fallback + file) -->
  <link rel="stylesheet" href="/css/styles.css">
  <style id="critical-theme-vars">
    :root {
      --primary-color:#d4a759;
      --secondary-color:#b55c3b;
      --accent-color:#f5e9da;
      --dark-text:#3d2c1d;
      --light-background:#f8f9fa;
      --card:#fff;
      --muted:#6b7280;
    }
    body { background: var(--light-background); font-family: 'Poppins', sans-serif; color: var(--dark-text); }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Topbar -->
  <nav class="navbar navbar-expand bg-body border-bottom sticky-top shadow-sm">
    <div class="container-fluid">
      <button class="btn btn-outline-secondary me-2" type="button" data-sidebar-toggle>
        <i class="bi bi-list"></i>
      </button>

      <a class="navbar-brand d-flex align-items-center gap-2 fw-semibold" href="#/dashboard">
        <img src="/images/Ank_Logo.png" alt="ANKVIDHYA" class="brand-logo">
        <span>ANKVIDHYA ERP</span>
      </a>

      <div class="ms-auto d-flex align-items-center gap-2">
        <button id="btnTheme" class="btn btn-outline-secondary" title="Toggle theme">
          <i class="bi bi-moon"></i>
        </button>

        <div class="dropdown">
          <button class="btn btn-outline-secondary position-relative" data-bs-toggle="dropdown" aria-expanded="false" title="Notifications">
            <i class="bi bi-bell"></i>
            <span id="notifDot" class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle d-none"></span>
          </button>
          <div class="dropdown-menu dropdown-menu-end p-0" style="min-width:320px;max-height:400px;overflow:auto">
            <div class="list-group list-group-flush" id="notifList">
              <div class="list-group-item text-muted small">No notifications</div>
            </div>
          </div>
        </div>

        <div class="dropdown">
          <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle me-1"></i><span id="topProfileName">Profile</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#/settings"><i class="bi bi-gear"></i> Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><button id="btnLogout" class="dropdown-item text-danger"><i class="bi bi-box-arrow-right"></i> Logout</button></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="appSidebar">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title">Menu</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
      <div class="list-group list-group-flush" id="sidebarMenu"></div>
    </div>
  </div>

  <!-- Main outlet -->
  <main class="container-fluid my-3">
    <div id="app"></div>
  </main>

  <!-- Toasts -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastArea"></div>

  <!-- Vendor JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- CONFIG: final (filled) -->
  <script>
    // === IMPORTANT: backend public URL (ngrok or production). ===
    // Set to the ngrok URL your backend printed: (including https://)
    window.CONFIG = window.CONFIG || {};
    window.CONFIG.API_BASE = 'https://hallucinational-ratlike-coralie.ngrok-free.dev';
    console.info('[CONFIG] API_BASE =', window.CONFIG.API_BASE);
  </script>

  <!-- Core libs (order matters) -->
  <script src="/js/ui.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/api.js"></script>

  <!-- Sidebar / routing / components -->
  <script src="/js/menu.js"></script>
  <script src="/js/rls.js"></script>
  <script src="/js/router.js"></script>
  <script src="/js/components/datagrid.js"></script>
  <script src="/js/components/formkit.js"></script>

  <!-- Pages -->
  <script src="/js/pages/login.js"></script>
  <script src="/js/pages/dashboard.js"></script>
  <script src="/js/pages/reports.js"></script>
  <script src="/js/pages/students.js"></script>
  <script src="/js/pages/users.js"></script>
  <script src="/js/pages/master.js"></script>
  <script src="/js/pages/employees.js"></script>
  <script src="/js/pages/schools.js"></script>
  <script src="/js/pages/courses.js"></script>
  <script src="/js/pages/books.js"></script>
  <script src="/js/pages/chapters.js"></script>
  <script src="/js/pages/faculty-assign.js"></script>
  <script src="/js/pages/lessonplans.js"></script>
  <script src="/js/pages/videos.js"></script>
  <script src="/js/pages/payments.js"></script>
  <script src="/js/pages/payrolls.js"></script>
  <script src="/js/pages/expenses.js"></script>
  <script src="/js/pages/faculty-dp.js"></script>
  <script src="/js/pages/emp-video-progress.js"></script>
  <script src="/js/pages/timetables.js"></script>
  <script src="/js/pages/class-sessions.js"></script>
  <script src="/js/pages/emp-attendance.js"></script>
  <script src="/js/pages/student-attendance.js"></script>
  <script src="/js/pages/notebook-checks.js"></script>

  <!-- App boot -->
  <script src="/js/app.js"></script>

  <!-- Theme toggler -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const KEY = 'theme';
      const html = document.documentElement;
      const btn = document.getElementById('btnTheme');
      function safeGetStorage(k){ try{ return localStorage.getItem(k);}catch(e){return null;} }
      function safeSetStorage(k,v){ try{ localStorage.setItem(k,v);}catch(e){} }
      function systemPref(){ try{ return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }catch(e){return 'light'} }
      function applyTheme(theme){ theme = theme==='dark'?'dark':'light'; html.setAttribute('data-bs-theme', theme); if(btn){ const icon = btn.querySelector('i'); if(icon){ icon.classList.remove('bi-moon','bi-brightness-high'); icon.classList.add(theme==='dark'?'bi-brightness-high':'bi-moon'); } } }
      function initTheme(){ const s = safeGetStorage(KEY); applyTheme(s || systemPref()); }
      initTheme();
      if (btn) btn.addEventListener('click', ()=>{ const next = html.getAttribute('data-bs-theme')==='dark'?'light':'dark'; applyTheme(next); safeSetStorage(KEY,next); });
    });
  </script>

</body>
</html>
